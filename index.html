<!DOCTYPE html>
<html>
  <head>
    <title>Software Development at Trabe 2</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="slide-pack.css">
    <link rel="stylesheet" type="text/css" href="custom.css">
  </head>
  <body id="sdat">

<textarea data-slide-pack>

-- front-page

# Software Development at Trabe<br><span class="invisible magno">2</span>

-- front-page

# Software Development at Trabe<br><span class="magno">2</span>

-- who

<p>
    **David Barral**<br>
    david@trabesoluciones.com<br>
    @davidbarral
</p>

<p>
    **Asís García**<br>
    asis@trabesoluciones.com<br>
    @asischao
</p>

-- full-width-image

![Trabe](assets/trabe.png)

-- toc

# Contents

* Hows & whys
* Tools
* Fears

-- section

# Hows & whys

-- quote

> A good design is easy to change, rather than easy to configure
> <cite>someone, somewhere</cite>

--

# There is no silver bullet

## Every architecture has pros & cons

--

# There is no silver bullet

## Every design has pros & cons

--

# There is no silver bullet

## Every technology has pros & cons

--

# There is no silver bullet

## Every language has pros & cons

--

# There is no silver bullet

## Every tool has pros & cons

--

# Architecture & technology should fit the problem

--

# The solution should fit the problem

--

# Simple is better

## Simple vs Easy

-- two-columns

# Simple solutions are easier to:

* Grasp
* Design
* Code
* Document
* Mantain
* Evolve

--

# Architecture: the UNIX way

## Orchestrate simple components,<br> each doing one thing, <br/>and doing it well

--

# Design: SOLID

## KISS & DRY driven

--

# S for SRP
## Single Responsability Principle

--

# Other useful buzzwords

* YAGNI
* CoC

-- two-columns

# TEST, TEST, TEST

* TDD, BDD
* Regresions
* Benchmarks
* DI
* Refactoring
* CI

-- full-width-image lights-off


![Every time god kills a kitten](assets/god_kitten.png)

--

# True OO

* Composition vs hierarchy
* Polimorfism: if-less code
* "El entramado de vínculos"

--

# Immutability

* Avoid side effects
* Use persistent data structures

--

# Back to the function

* Data 
* Pure functions
* Function composition

-- section

# Methodology

--

# The Trábico process

## Agile, sort of __: )__

-- 

# Project management

* Weekly meetings
* Postmortem
* Simple tools

-- full-width-image

![Trabeboard](assets/trabeboard.png)

-- full-width-image

![Trello](assets/trello.png)

--

# Project development

* Continuous vs scheduled delivery
* TDD
* Code reviews
* Pair programming
* Powerful tools

--

![Git](assets/git_lol.png)

-- full-width-image

![Bitbucket README](assets/bitbucket_readme.png)

-- full-width-image

![Bitbucket Pull Request](assets/bitbucket_pull_request.png)

-- full-width-image

![Bitbucket Pull Request Diff](assets/bitbucket_pull_request_code.png)

-- full-width-image

![Confluence](assets/confluence.png)

--

# DRY development

* Conventions
* Automation
* Scripts
* Bootstrap

--

    $ git clone trabe:awesome-project
    $ cd awesome-project
    $ ./bin/setup

--

# TESTs, TESTs, TESTs

* Automatic run (guard)
* Mocking
* Metrics (coverage)

--

# Conveniences

* Transpilers: Babel, SASS, etc.
* Debuggers
* Profilers
* Live Reload. YAY!

-- full-width-image

![Chrome tools](assets/chrome_tools_dom.png)

-- full-width-image

![Chrome tools](assets/chrome_tools_debugger.png)

-- full-width-image

![Chrome tools](assets/chrome_tools_network.png)

-- full-width-image

![Chrome tools](assets/chrome_tools_emulation.png)

-- section

# Fears
## The many hells of Computer Science

-- quote

> There are only two hard things in Computer Science:<br> cache invalidation and naming things.
> <cite>Phil Karlton</cite>

--

# Easy cache invalidation

## LRU Caches + Auto expiring keys

-- code small

      class User
        def cache_key
          "user#" + id + "#" +
            updated_at.to_millis
        end
      end


      cache user.cache_key do
        ...
      end

--

# Easy naming

## There is no easy naming. Sorry folks!

-- full-width-image

![Yao Ming](assets/yao.png)

--

# Maybe there are more hard things

-- full-width-image

![Mother of God](assets/mother_of_god.png)

--

# Encoding hell

## Use UTF-8. Use iconv wisely

-- full-width-image

![Encoding](assets/encoding.png)

--

# Timezones, i18n, l11n, accessibility hell

## Always use UTC (beware of quirks)
## Treat i18n, l11n and accesibility as first class citizens

--

# Speaking of timezones...

-- full-width-image

![TZ hell](assets/tz_hell.png)

-- full-width-image

![Fuck ti](assets/fuck_timezones.png)

--

# The money hell
## Beware of spanish taxes and accounting
## Use f**king cents

--

# The money hell <br/>a.k.a the floating point hell
## Stick to integers. Use fixed point

-- full-width-image

![Show me the money](assets/show_me_the_money.jpg)

--

# Dependency hell
## A dependency manager is not a guarantee: e.g. npm
## Use virtual machines (docker)

--

# Deployment and<br/>environments hell

## Define enviroments from square one
## Automatize deployment as much as you can

--

![Mina deploy](assets/mina.gif)

--

# Documentation/Code sync hell

## Self explanatory code
## Document APIs
## Document wisely
## Treat documentation as part of the code

-- code smallest

    /**
     * Returns the user names in alphabetical order
     * @returns the names
     */
    public String[] orderedNames() {
      return sortAlphabetically(this.getNames());
    }

    /*
     * Sort with quicksort algorithm
     */
    private String[] sortAlphabetically(String[] words) {
      // lines of elegant yet uninteligible code ;)
    }

--

# Multithreading hell

## Use multi process
## Avoid too much low level

-- bullets bullets-first

# Inter Process Communication

* Unix Sockets
* Queues
* Shared memory

--

# Or use an abstraction
 * Actors
 * Promises
 * CSP

--

# Or switch to erlang :P


-- bullets title-first

# Fragmentation hell

* Do your HTML5/CSS3/JS homework (it's all code!)
* Know how to tame browsers
* Know how to tame mobile

--

![Bitbucket Ok](assets/bit_ok.png)

--

![Bitbucket full](assets/bit_bad.png)

-- lights-off

![Bitbucket Android](assets/bit_android.png)

--

# MVC Inception

## Inside an MVC webapp there is another MVC app

-- section

# The "six" commandments
## Parting note


-- chain-bullets
# SOLID (SRP in particular)

* &#x2193;
* Simple
* &#x2193;
* Easy to change
* &#x2193;
* Happiness __\\(^o^)/__

-- chain-bullets
# YAGNI

* &#x2193;
* Simple
* &#x2193;
* Easy to change
* &#x2193;
* Happiness __\\(^o^)/__

-- chain-bullets

# TESTs

* &#x2193;
* YAGNI + SOLID
* &#x2193;
* Simple
* &#x2193;
* Easy to change
* &#x2193;
* Happiness __\\(^o^)/__

-- chain-bullets

# Refactor (code and tests)

* &#x2193;
* Better code & tests
* &#x2193;
* ... 
* &#x2193;
* Happiness __\\(^o^)/__

--

# DRY more than your code

## Automatize, share, extract

--

## The most important commandment

# Do what feels right!

--


##These slides were brought to you by

#[SlidePack](http://trabe.github.io/slide-pack)
trabe.github.io/slide-pack


--

# Do your EOM projects at Trabe

--

# Questions?

-- full-image

![Hasta la vista baby](assets/hasta_la_vista_baby.jpg)

-- section

# ENCORE
## Real life examples

-- section

# FEDERICO

-- problem

# Problem

## Signup/signin on multiple services
## Consolidate personal info

-- solution bullets bullets-first

# Solution

* Procedure repository
* Orchestrate services (Service Bus)
* Single Sign On

--

![Federico ideal](assets/federico_ideal.jpg)

--

![Federico full](assets/federico_full.jpg)

-- bullets bullets-first

# Technology

* Java stack
* Ruby for automation

-- section

# NeoSAI

-- problem

# Context

## Laboratory Management System

--

![NeoSAI design](assets/neosai_design.jpg)


-- problem

# Problem

## Different kinds of UIs

-- solution bullets wide-bullets

# Solution

* Basic CRUD: forms & listings
* Advanced CRUD: JS components + AJAX
* Complex tasks: Single-page app + REST


-- problem

# Problem

## Integrate new & legacy app


-- solution bullets wide-bullets

# Solution

* Shared DB
* REST APIs (JSON preferred)
* SSO
* UI integration via IFrame +<br/>HTML5 PubSub

--

![SAI Integration](assets/sai_integration.jpg)

-- problem

# Problem

## Integrate "nonintegrable"<br/> third party software

-- solution bullets

# Solution

* Ad hoc REST API
* Mail vacuums

--

![testo_wamp](assets/testo_wamp.jpg)

-- problem

# Problem

## Mail log: different sources

-- solution

# Solution

## Wrapper + REST API

--

![Mail wrapper](assets/mail_wrapper.jpg)

-- problem

# Problem

## Complex permission checks

-- quote

>  Can change a report if I am the author or its author is one of my subordinates and the report has not been signed
> <cite>the customer</cite>

-- solution

# Solution

## Policy objects

-- code small

    class ReportsController
      def edit
        report = Report.find(params[:id])
        can_edit = ReportEditorPolicy.
          new(current_user, report).comply?
        ...

-- code small

    class ReportEditorPolicy < Policy
      def initialize(user, report)
        ...
      end

      def comply?
        (owner_of_report? or
        subordinate_report?) and
        unsigned_report?
      end

      ...


-- problem

# Problem

## Run the same business logic from different places

-- solution

# Solution

## Context objects
## Runnable from controllers,<br/>console, APIs, cron jobs

-- code small

    class CreateUserContext
      def initialize(user_params, notifier)
        ...
      end

      def run
        user = User.new(user_params)
        if user.save
          notifier.send(:new_user, user)
        end
      end
    end




-- problem

# Problem

## Run business logic as different users, even as no user

-- solution bullets

# Solution

* Context objects
* Runnable as user
* NullUser (NullObject pattern)

-- bullets title-first

# NullObject pattern

* Remove branching logic
* Avoid null errors
* Improves testability

-- code smallest

    class User {
        constructor(name) {
            this.name = name;
        }
    }

    const greet = function (user) {
        if user {
            alert(`Hi #{user.name}!`);
        }
        else {
            alert("Hi stranger!");
        }
    }

    const john = new User('John');
    const keith = null;

    greet(john);    # Hi John!
    greet(keith);   # Hi stranger!

-- code smallest

    class User {
        constructor(name) {
            this.name = name;
        }
    }

    class Stranger extends User {
        constructor() {
            super("stranger");
        }
    }

    const greet = function (user) {
        alert(`Hi #{user.name}!`);
    }

    const john = new User('John');
    const keith = new Stranger();

    greet(john);    # Hi John!
    greet(keith);   # Hi stranger!

-- problem

# Problem

## Limit data access based on user roles

-- solution bullets

# Solution

* Inject user with role dependent methods to access the model
* Similar to State pattern (sort of)

--

![User roles](assets/user_roles.jpg)


--
# DCI

## Data, Context, Interaction

--

    class BankAccount
      attr_accessor :balance
    end

    module TransferSource
      def withdraw(amount)
        self.balance -= amount
      end
    end

    module TransferTarget
      def deposit(amount)
        self.balance += amount
      end
    end

--
```ruby
class TransferContext
  def initialize(source, target, amount)
    ...
  end

  def run
    source.extends TransferSoure
    target.extends TransferTarget

    source.withdraw amount
    target.deposit amount
  end
end
```
-- bullets title-first many-bullets

# DCI

* SRP
* Reusability
* Testability
* Best with dynamic langs
* Beware of implementation quirks


-- problem
# Problem
## Present same model object in different ways on different views

-- solution bullets
# Solution

* Decorator pattern
* Decorate associations too
* One or multiple decorators
* Variant: presenter pattern

-- code smallest

```ruby
class User
  def initialize(name, email)
    ...
  end
end

class UserDecorator
  def initialize(user)
    ...
  end

  def name
    user.name
  end

  def email
    user.name + "<" + user.email + ">"
  end
end
```

-- code small

    user = User.new('john', 'john@mail.com')
    decorated_user = UserDecorator.new(user)
    mail = new Mail()

    mail.send to: decorated_user.email

-- problem

# Problem
## Global search

-- solution bullets

# Solution
* External Indexer (REST API)

--

![Indexer](assets/indexer.jpg)

-- problem

# Problem
## Long running contexts

-- solution bullets

# Solution
* Execute contexts in background
* Jobs queues
* Jobs executor

--

![Background Jobs](assets/bg_jobs.jpg)

</textarea>

    <script src="slide-pack.js"></script>
  </body>
</html>

